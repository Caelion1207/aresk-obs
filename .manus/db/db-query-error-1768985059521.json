{
  "query": "\n-- Paso 1: Crear tabla temporal con IDs de sesiones a eliminar\nCREATE TEMPORARY TABLE sessions_to_delete AS\nSELECT s.id\nFROM sessions s\nLEFT JOIN (\n  SELECT sessionId, COUNT(*) as message_count\n  FROM messages\n  GROUP BY sessionId\n) msg_count ON s.id = msg_count.sessionId\nWHERE COALESCE(msg_count.message_count, 0) < 30;\n\n-- Paso 2: Eliminar métricas relacionadas\nDELETE FROM metrics WHERE sessionId IN (SELECT id FROM sessions_to_delete);\n\n-- Paso 3: Eliminar mensajes relacionados\nDELETE FROM messages WHERE sessionId IN (SELECT id FROM sessions_to_delete);\n\n-- Paso 4: Eliminar marcadores temporales relacionados\nDELETE FROM timeMarkers WHERE sessionId IN (SELECT id FROM sessions_to_delete);\n\n-- Paso 5: Eliminar alertas de sesión relacionadas\nDELETE FROM sessionAlerts WHERE sessionId IN (SELECT id FROM sessions_to_delete);\n\n-- Paso 6: Eliminar las sesiones\nDELETE FROM sessions WHERE id IN (SELECT id FROM sessions_to_delete);\n\n-- Paso 7: Mostrar resumen\nSELECT \n  'Sesiones eliminadas' as operation,\n  COUNT(*) as count\nFROM sessions_to_delete;\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 2dHuGejaB9KJLvX.3ad583a027c2 --database JW6GZLBSW7tW5drfiLvsL8 --execute \n-- Paso 1: Crear tabla temporal con IDs de sesiones a eliminar\nCREATE TEMPORARY TABLE sessions_to_delete AS\nSELECT s.id\nFROM sessions s\nLEFT JOIN (\n  SELECT sessionId, COUNT(*) as message_count\n  FROM messages\n  GROUP BY sessionId\n) msg_count ON s.id = msg_count.sessionId\nWHERE COALESCE(msg_count.message_count, 0) < 30;\n\n-- Paso 2: Eliminar métricas relacionadas\nDELETE FROM metrics WHERE sessionId IN (SELECT id FROM sessions_to_delete);\n\n-- Paso 3: Eliminar mensajes relacionados\nDELETE FROM messages WHERE sessionId IN (SELECT id FROM sessions_to_delete);\n\n-- Paso 4: Eliminar marcadores temporales relacionados\nDELETE FROM timeMarkers WHERE sessionId IN (SELECT id FROM sessions_to_delete);\n\n-- Paso 5: Eliminar alertas de sesión relacionadas\nDELETE FROM sessionAlerts WHERE sessionId IN (SELECT id FROM sessions_to_delete);\n\n-- Paso 6: Eliminar las sesiones\nDELETE FROM sessions WHERE id IN (SELECT id FROM sessions_to_delete);\n\n-- Paso 7: Mostrar resumen\nSELECT \n  'Sesiones eliminadas' as operation,\n  COUNT(*) as count\nFROM sessions_to_delete;\n",
  "returncode": 1,
  "logs": [
    "ERROR 1105 (HY000) at line 3: 'CREATE TABLE ... SELECT' is not implemented yet"
  ]
}