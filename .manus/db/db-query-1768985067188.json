{
  "query": "\n-- Eliminar métricas de sesiones con menos de 30 mensajes\nDELETE FROM metrics \nWHERE sessionId IN (\n  SELECT s.id\n  FROM sessions s\n  LEFT JOIN (\n    SELECT sessionId, COUNT(*) as message_count\n    FROM messages\n    GROUP BY sessionId\n  ) msg_count ON s.id = msg_count.sessionId\n  WHERE COALESCE(msg_count.message_count, 0) < 30\n);\n\n-- Eliminar mensajes de sesiones con menos de 30 mensajes\nDELETE FROM messages \nWHERE sessionId IN (\n  SELECT s.id\n  FROM sessions s\n  LEFT JOIN (\n    SELECT sessionId, COUNT(*) as message_count\n    FROM messages\n    GROUP BY sessionId\n  ) msg_count ON s.id = msg_count.sessionId\n  WHERE COALESCE(msg_count.message_count, 0) < 30\n);\n\n-- Eliminar marcadores temporales de sesiones con menos de 30 mensajes\nDELETE FROM timeMarkers \nWHERE sessionId IN (\n  SELECT s.id\n  FROM sessions s\n  LEFT JOIN (\n    SELECT sessionId, COUNT(*) as message_count\n    FROM messages\n    GROUP BY sessionId\n  ) msg_count ON s.id = msg_count.sessionId\n  WHERE COALESCE(msg_count.message_count, 0) < 30\n);\n\n-- Eliminar alertas de sesión de sesiones con menos de 30 mensajes\nDELETE FROM sessionAlerts \nWHERE sessionId IN (\n  SELECT s.id\n  FROM sessions s\n  LEFT JOIN (\n    SELECT sessionId, COUNT(*) as message_count\n    FROM messages\n    GROUP BY sessionId\n  ) msg_count ON s.id = msg_count.sessionId\n  WHERE COALESCE(msg_count.message_count, 0) < 30\n);\n\n-- Eliminar las sesiones con menos de 30 mensajes\nDELETE FROM sessions \nWHERE id IN (\n  SELECT s.id\n  FROM sessions s\n  LEFT JOIN (\n    SELECT sessionId, COUNT(*) as message_count\n    FROM messages\n    GROUP BY sessionId\n  ) msg_count ON s.id = msg_count.sessionId\n  WHERE COALESCE(msg_count.message_count, 0) < 30\n);\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 2dHuGejaB9KJLvX.3ad583a027c2 --database JW6GZLBSW7tW5drfiLvsL8 --execute \n-- Eliminar métricas de sesiones con menos de 30 mensajes\nDELETE FROM metrics \nWHERE sessionId IN (\n  SELECT s.id\n  FROM sessions s\n  LEFT JOIN (\n    SELECT sessionId, COUNT(*) as message_count\n    FROM messages\n    GROUP BY sessionId\n  ) msg_count ON s.id = msg_count.sessionId\n  WHERE COALESCE(msg_count.message_count, 0) < 30\n);\n\n-- Eliminar mensajes de sesiones con menos de 30 mensajes\nDELETE FROM messages \nWHERE sessionId IN (\n  SELECT s.id\n  FROM sessions s\n  LEFT JOIN (\n    SELECT sessionId, COUNT(*) as message_count\n    FROM messages\n    GROUP BY sessionId\n  ) msg_count ON s.id = msg_count.sessionId\n  WHERE COALESCE(msg_count.message_count, 0) < 30\n);\n\n-- Eliminar marcadores temporales de sesiones con menos de 30 mensajes\nDELETE FROM timeMarkers \nWHERE sessionId IN (\n  SELECT s.id\n  FROM sessions s\n  LEFT JOIN (\n    SELECT sessionId, COUNT(*) as message_count\n    FROM messages\n    GROUP BY sessionId\n  ) msg_count ON s.id = msg_count.sessionId\n  WHERE COALESCE(msg_count.message_count, 0) < 30\n);\n\n-- Eliminar alertas de sesión de sesiones con menos de 30 mensajes\nDELETE FROM sessionAlerts \nWHERE sessionId IN (\n  SELECT s.id\n  FROM sessions s\n  LEFT JOIN (\n    SELECT sessionId, COUNT(*) as message_count\n    FROM messages\n    GROUP BY sessionId\n  ) msg_count ON s.id = msg_count.sessionId\n  WHERE COALESCE(msg_count.message_count, 0) < 30\n);\n\n-- Eliminar las sesiones con menos de 30 mensajes\nDELETE FROM sessions \nWHERE id IN (\n  SELECT s.id\n  FROM sessions s\n  LEFT JOIN (\n    SELECT sessionId, COUNT(*) as message_count\n    FROM messages\n    GROUP BY sessionId\n  ) msg_count ON s.id = msg_count.sessionId\n  WHERE COALESCE(msg_count.message_count, 0) < 30\n);\n",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 123
}